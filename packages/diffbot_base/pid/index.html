
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://ros-mobile-robots.com/packages/diffbot_base/pid/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-8.5.10" name="generator"/>
<title>PID Controllers - DiffBot Differential Drive Mobile Robot</title>
<link href="../../../assets/stylesheets/main.975780f9.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<script src="../../../js/jquery-3.5.1.min.js"></script>
<script src="../../../js/jquery.fitvids.js"></script>
<!-- Arithmatex -->
<!-- MathJax
        <script src="../../../js/mathjax.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        -->
<!-- KaTeX -->
<script src="../../../js/katex.js"></script>
<script crossorigin="anonymous" integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc=" src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js">
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/>
<!-- Pseudocode -->
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>
        pseudocode.renderElement(document.getElementById("markov-localization"));
    </script>
<!-- UML diagrams using Mermaid -->
<script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
<script>
        mermaid.initialize({ startOnLoad: true, securityLevel: "loose" });
    </script>
<!-- Adsense -->
<script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2214309606626131"></script>
<!-- Cookie consent -->
<link href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" rel="stylesheet" type="text/css">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-5Z9V7GPRX3"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-5Z9V7GPRX3",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-5Z9V7GPRX3",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</link><link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="white" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#pid-controllers">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DiffBot Differential Drive Mobile Robot" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="DiffBot Differential Drive Mobile Robot">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DiffBot Differential Drive Mobile Robot
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              PID Controllers
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="white" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ros-mobile-robots/diffbot" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../technical_requirements/">
        Getting Started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../hardware_setup/overview/">
        Hardware Setup
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../processing_units/">
        Processing Units
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../">
        ROS Software Packages
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../theory/">
        Robotics Theory
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../theory/motion-and-odometry/">
        Hardware and Theory
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../insiders/">
      Insiders
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DiffBot Differential Drive Mobile Robot" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="DiffBot Differential Drive Mobile Robot">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    DiffBot Differential Drive Mobile Robot
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ros-mobile-robots/diffbot" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Getting Started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../technical_requirements/">
        Technical Requirements
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../components/">
        Components
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Hardware Setup
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Hardware Setup" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Hardware Setup
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hardware_setup/overview/">
        Hardware Setup Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hardware_setup/3D_print/">
        3D Printing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hardware_setup/electronics/">
        Electronics
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hardware_setup/assembly/">
        Assembly
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hardware_setup/install/">
        Install
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../processing_units/">Processing Units</a>
<label for="__nav_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Processing Units" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Processing Units
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
          Single Board Computer
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Single Board Computer" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Single Board Computer
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/rpi-setup/">
        Raspberry Pi Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/jetson-nano-setup/">
        Jetson Nano Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/git-setup/">
        Git Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/ros-setup/">
        ROS Setup
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/teensy-mcu/">
        Microcontroller
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/hardware-interfaces/">
        Hardware Interfaces
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../processing_units/ros-network-setup/">
        ROS Network Setup
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../">ROS Software Packages</a>
<label for="__nav_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="ROS Software Packages" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          ROS Software Packages
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../packages-setup/">
        Packages Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_robot/">
        Robot Package
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" id="__nav_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_4">
          Robot Description
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Robot Description" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
          Robot Description
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../robot-description/">
        Robot Description
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../remo_description/">
        Remo Description
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_gazebo/">
        Simulation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_control/">
        Control
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_7" id="__nav_5_7" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../">Base Hardware Interface</a>
<label for="__nav_5_7">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Base Hardware Interface" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_7">
<span class="md-nav__icon md-icon"></span>
          Base Hardware Interface
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          PID Controllers
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        PID Controllers
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#gain-trim-model">
    Gain / Trim Model
  </a>
<nav aria-label="Gain / Trim Model" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pid-tuning">
    PID Tuning
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-issues-to-pids">
    Related Issues to PIDs
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../low-level/">
        Low-Level PID Approach
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../high-level/">
        High-Level PID Approach
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_msgs/">
        Messages
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../grove_motor_driver/">
        Motor Driver
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DG01D-E-motor-with-encoder/">
        Motor and Encoder
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_navigation/">
        Navigation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_slam/">
        SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_mbf/">
        Move Base Flex
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diffbot_bringup/">
        Hardware Bringup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../raspicam_node/">
        Rasperry Pi Camera
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_16" id="__nav_5_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_16">
          Inertial Measurement Unit
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Inertial Measurement Unit" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_16">
<span class="md-nav__icon md-icon"></span>
          Inertial Measurement Unit
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../imu/robot_localization/">
        Robot Localization
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../imu/driver-bno055/">
        BNO055 Driver
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../theory/">Robotics Theory</a>
<label for="__nav_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Robotics Theory" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Robotics Theory
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2">
          Preliminaries
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Preliminaries" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
          Preliminaries
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/preliminaries/linear-algebra/">
        Linear Algebra
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/preliminaries/probability/">
        Probability
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/preliminaries/programming/">
        Programming
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" id="__nav_6_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_3">
          Modeling and Control
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Modeling and Control" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
          Modeling and Control
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/modeling-control/control-systems-introduction/">
        Introduction to Control Systems
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/modeling-control/robot-representations/">
        Representations and models
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/modeling-control/modeling-differential-drive-robot/">
        Modeling a Differential Drive Robot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/modeling-control/odometry/">
        Odometry
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" id="__nav_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4">
          Robot Vision
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Robot Vision" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
          Robot Vision
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/robot-vision/pinhole-camera-model/">
        Pinhole Camera Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/robot-vision/camera-calibration/">
        Camera Calibration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/robot-vision/image-processing/">
        Image Processing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/robot-vision/features-and-segmentation/">
        Features and Segmentation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/robot-vision/tracking-image-features/">
        Tracking Image Features
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/robot-vision/combining-camera-and-lidar/">
        Combining Camera and Lidar
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/object-detection/overview.md">
        Object Detection
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" id="__nav_6_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_6">
          State Estimation
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="State Estimation" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_6">
<span class="md-nav__icon md-icon"></span>
          State Estimation
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/state-estimation/recursive-state-estimation/">
        Recursive State Estimation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/state-estimation/gaussian-filters.md">
        Gaussian Filters (Kalman Filter)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/state-estimation/nonparametric-filters/">
        Nonparametric Filters (Particle Filter)
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" id="__nav_6_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_7">
          Localization
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Localization" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_7">
<span class="md-nav__icon md-icon"></span>
          Localization
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/localization/markov-and-gaussian-localization/">
        Markov and Gaussian Localization
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/localization/grid-and-monte-carlo-localization.md">
        Grid and Monte Carlo Localization
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_8" id="__nav_6_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_8">
          Mapping
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Mapping" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_8">
<span class="md-nav__icon md-icon"></span>
          Mapping
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/mapping/occupancy-grid-mapping.md">
        Occupancy Grid Mapping
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_9" id="__nav_6_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_9">
          Simultaneous Localization and Mapping (SLAM)
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Simultaneous Localization and Mapping (SLAM)" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_9">
<span class="md-nav__icon md-icon"></span>
          Simultaneous Localization and Mapping (SLAM)
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/slam-overview/">
        SLAM Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/1.%20Robot%20Moving%20and%20Sensing/">
        Robot Class
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/2.%20Omega%20and%20Xi%2C%20Constraints/">
        Omega and Xi Constraints Notebook
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/3.%20Landmark%20Detection%20and%20Tracking/">
        Project 3:  Implement SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/ekf-slam.md">
        EKF SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/graphslam.md">
        GraphSLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/fastslam.md">
        FastSLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/slam/gmapping.md">
        GMapping
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/planning1/overview.md">
        Planning I
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/planning2/overview.md">
        Planning II
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/reinforcement-learning/overview.md">
        Learning by Reinforcement
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/imitation-learning/overview.md">
        Learning by Imitation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
          Hardware and Theory
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Hardware and Theory" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Hardware and Theory
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../theory/motion-and-odometry/">
        Motion and Odometry
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../power-supply/">
        Power Supply
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../laser-range-scanner/">
        Laser Range Scanner
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../insiders/">
        Insiders
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#gain-trim-model">
    Gain / Trim Model
  </a>
<nav aria-label="Gain / Trim Model" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pid-tuning">
    PID Tuning
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-issues-to-pids">
    Related Issues to PIDs
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/ros-mobile-robots/ros-mobile-robots.github.io/tree/main/docs/packages/diffbot_base/pid.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="pid-controllers">PID Controllers</h1>
<p>DiffBot uses two PID controllers, one for each motor.
Depending on which software version you use the two PID controllers are located in
different locations in the source code. Either the two PIDs are in the</p>
<ul>
<li>hardware interface: high-level approach until version 0.0.2, or</li>
<li>base controller firmware: low-level approach starting from version 1.0.0</li>
</ul>
<p>The current approach (starting from version 1.0.0) operates the PIDs in the
low-level base controller firmware.</p>
<p>Regardless of the location (high or low-level), each PID is passed the error
between velocity measured by the encoders and the target velocity computed by
the <code>diff_drive_controller</code> for a specific wheel joint. The
<code>diff_drive_controller</code> doesn't have a PID controller integrated, and doesn't
take care if the wheels of the robot are actually turning. As mentioned above,
ROS Control expects that the commands sent by the controller are actually
applied on the real robot hardware and that the joint states are always up
to date. This means that the <code>diff_drive_controller</code> just uses the <code>twist_msg</code>
on the <code>cmd_vel</code> topic for example from the <code>rqt_robot_steering</code> and converts it
to a velocity command for the motors. It doesn't take the actual velocity of the
motors into account.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a href="https://github.com/ros-controls/ros_controllers/blob/698f85b2c3467dfcc3ca5743d68deba03f3fcff2/diff_drive_controller/src/diff_drive_controller.cpp#L460">the code of <code>diff_drive_controller</code></a> where the <code>joint_command_velocity</code> is calculated. </p>
</div>
<p>For this reason a PID controller can help to avoid situations such as the following where the robot moves not straigth although it's commanded to do so:</p>
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube-nocookie.com/embed/chUPeWXtim4" width="560"></iframe>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The video runs version 0.0.2, operating the PIDs in the high-level hardware interface.</p>
</div>
<p>The PIDs used in the video inherits from the ROS Control
<a href="http://wiki.ros.org/control_toolbox"><code>control_toolbox::Pid</code></a> that provides
Dynamic Reconfigure out of the box to tune the proportional, integral and
derivative gains. The behaviour when using only the P, I and D gains is that the
output can overshoot and even change between positive and negative motor percent
values because of a P gain that is too high. To avoid this, a feed forward gain F
can help to reach the setpoint faster. In the high-level approach this feed forward gain is present as a dynamic reconfigure parameter, defined in the in the <code>pid.yml</code> configuration file in the <code>cfg</code> folder of this package.</p>
<p>For more details on ROS dynamic reconfigure see <a href="http://wiki.ros.org/dynamic_reconfigure/Tutorials">the official tutorials</a>.</p>
<p>With the use of the PID controller the robot is able to drive straight:</p>
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube-nocookie.com/embed/fdn5Mu0Qhl8" width="560"></iframe>
<p>In case of using inexpensive motors like the <a href="https://www.sparkfun.com/products/16413">DG01D-E</a> of DiffBot,
you have to take inaccurate driving behaviour into account. The straight driving behaviour can be improved
with motors that start spinning at the same voltage levels. To find suitable motors do a voltage sweep test by slightly increasing the voltage and
note the voltage level where each motor starts to rotate. Such a test was done on DiffBot's motors. </p>
<p>Using six <a href="https://www.sparkfun.com/products/16413">DG01D-E</a> motors the following values were recorded (sorted by increasing voltage):</p>
<table>
<thead>
<tr>
<th align="center">Motor</th>
<th align="center">Voltage (V)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">01</td>
<td align="center">2.5</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">2.8 - 3.0</td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">3.1</td>
</tr>
<tr>
<td align="center">04</td>
<td align="center">3.2</td>
</tr>
<tr>
<td align="center">05</td>
<td align="center">3.2</td>
</tr>
<tr>
<td align="center">06</td>
<td align="center">3.3</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the videos above, motors numbered 01 and 03 were used coincidencely and I
wasn't aware of the remarkable differences in voltage levels. Using the motors
04 and 05 improved the driving behaviour significantly.</p>
</div>
<p>To deal with significant differences in the motors it would also help to tune
the two PIDs individually, which is not shown in the <a href="https://youtu.be/fdn5Mu0Qhl8">video
above</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make also sure that the motor driver outputs the same voltage level on both channels when the robot is commanded to move straight.
The used Grove i2c motor driver was tested to do this.
Another problem of not driving straight can be weight distribution or the orientation of the caster wheel.</p>
</div>
<p>A good test to check the accuracy is to fix two meters of adhesive tape on the
floor in a straight line. Then, place the robot on one end oriented in the
direction to the other end. Now command it to move straight along the line and
stop it when it reaches the end of the tape. Record the lateral displacement
from the tape. Measuring a value below 10 cm is considered precise for these
motors.</p>
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/37M-3k2FCsQ" title="YouTube video player" width="560"></iframe>
<p>The video shows the real DiffBot robot as well as running the
<code>gazebo_ros_control</code> plugin with <code>diff_drive_controller</code> from ROS Control. The
robot is commanded to drive straight on a 2 meter test track. Five runs show
different offsets after 2 meter, which can be cause by:</p>
<ul>
<li>Orientation of the start pose</li>
<li>Inaccurate motors start to spin at different voltage levels</li>
<li>Low encoder resolution (geared output resolution at wheel)</li>
<li>Wheel slip or alignment of the left/right and caster wheel</li>
<li>Weight distribution</li>
<li>Manufacturing tolerances</li>
<li>Deformable material of the wheels generating different surfaces of contact with the ground depending on their assembly</li>
</ul>
<h2 id="gain-trim-model">Gain / Trim Model</h2>
<p>In case the robot constantly drives towards one side (e.g., to the left), this
issue might be overcome by tuning each PID individually. An alternative solution
can be gain and trim parameters, as implemented in the <a href="https://github.com/ros-mobile-robots/diffbot/blob/e7b6c8c5206235a338ef15e20084630793813a4f/diffbot_base/src/diffbot_hw_interface.cpp#L169"><code>write()</code> method of the
high-level hardware
interface</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">double</span><span class="w"> </span><span class="n">motor_constant_right_inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gain_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">trim_</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">motor_constant_</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">motor_constant_left_inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gain_</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">trim_</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">motor_constant_</span><span class="p">;</span><span class="w"></span>

<span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">motor_constant_left_inv</span><span class="p">;</span><span class="w"></span>
<span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">motor_constant_right_inv</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>The idea is that the trim coefficient <span class="arithmatex">\(t\)</span> is a "quick and dirty" way to account for
various nuisances of the physical robot, including differences in motors,
wheels, and the asymmetry of the robot. It's simple and easily interpretable,
too.</p>
<p>The two PIDs work to ensure that the wheels spin at the desired speed, but not
that the robot drives the desired way though. There are other factors such as
slightly different wheel raddi <span class="arithmatex">\(R\)</span> which lead to different rotational velocities
<span class="arithmatex">\(\dot{\phi}_{l/r}\)</span> (translational velocity <span class="arithmatex">\(v_{l/r} = \dot{\phi}_{l/r} \cdot R\)</span>) and therefore different traveled distances for each wheel (left and right) <span class="arithmatex">\(d_{l/r}\)</span>:</p>
<div class="arithmatex">\[
\begin{aligned}
d_{l/r} &amp;= v_{l/r} \cdot \Delta t \\
d_{l/r} &amp;= \frac{\dot{\phi}_{l/r}}{R} \cdot \Delta t
\end{aligned}
\]</div>
<p>These mechanical variations "can't be seen" by the encoders alone. For example
assume you want the robot to go straight, you would set the two desired
rotational wheel velocities <span class="arithmatex">\(\dot{\phi}_{l/r}\)</span>'s to be equal - but still the
robot would go left if, e.g., <span class="arithmatex">\(R_r &gt; R_l\)</span>, because, for the same wheel rotation
(ticks), the right wheel has traveled a bigger distance.</p>
<p>So the question is: what is the control objective?</p>
<p>When the control objective is to follow a desired reference position (angular or
lateral), it is more meaningful to measure that as error driving the PID
controller. But nothing stops us from having several PID controllers in cascade
sequence. One for the, e.g., lateral position, that computes the desired <span class="arithmatex">\((v_0,
\omega)\)</span> of the robot, and two more in parallel for the wheel velocities. Still,
there would be a trim coefficient to compensate for differences in traveled
distances of the two wheels.</p>
<p><span class="arithmatex">\(d_{l/r}\)</span> are the distances traveled by the left and right wheels, respectively, in a <span class="arithmatex">\(\Delta t\)</span>:</p>
<div class="arithmatex">\[
d_{l/r} = R_{l/r} \cdot \Delta \phi_{l/r}
\]</div>
<p>where <span class="arithmatex">\(\Delta \phi_{l/r}\)</span> are the rotations of each wheel (more accurately, of each motor), and <span class="arithmatex">\(R_{l/r}\)</span> is the radius of each wheel. If the radii are exactly the same, then <span class="arithmatex">\(R_l = R_r = R\)</span> and the approach using only two PID controllers would work because controlling <span class="arithmatex">\(\dot{\phi_{l/r}} \approx \frac{\Delta \phi_{l/r,k}}{\Delta t_k}\)</span> is equivalent to controlling <span class="arithmatex">\(\Delta \phi_{l/r,k}\)</span>, as the time interval we can assume known.</p>
<p>In practice, <span class="arithmatex">\(R_l = R_r = R\)</span> does not hold because of manufacturing tolerances, deformable material of the wheels generating different surfaces of contact with the ground depending on their assembly and robot mass distribution, etc.</p>
<p>The trim parameter <span class="arithmatex">\(t\)</span> we define as something that adjusts the relationship between the commands sent to the motors (imagine voltage <span class="arithmatex">\(V\)</span>) and the angular speed of each wheel (<span class="arithmatex">\(\dot{\phi}\)</span>):</p>
<div class="arithmatex">\[
\begin{aligned}
V_l = k(1-t) \dot \phi_l \\
V_r = k(1+t) \dot \phi_r
\end{aligned}
\]</div>
<p>Note that it's the same value of <span class="arithmatex">\(t\)</span> for the two motors (<span class="arithmatex">\(k\)</span>, just assume to be
a given constant). The way we tweak it is to find the value such that the robot
goes straight, that is, <span class="arithmatex">\(d_l = d_r\)</span> (over some distance), when we command it to go
straight, that is, we send the same voltages to the two wheels (<span class="arithmatex">\(V_l = V_r\)</span>).</p>
<div class="arithmatex">\[
\begin{aligned}
V_l &amp;= V_r \\
k(1-t) \dot\phi_l &amp;= k(1+t) \dot\phi_r
\end{aligned}
\]</div>
<p>From the two equations (<span class="arithmatex">\(V_l\)</span>, <span class="arithmatex">\(V_r\)</span>), by imposing the assumptions above and using the
definition of <span class="arithmatex">\(d_{l/r}\)</span>, we can derive <span class="arithmatex">\(t = \frac{R_r - R_l}{R_r + R_l}\)</span>, which basically shows how the trim is there to
(empirically) compensate for the difference in the wheel radii.</p>
<div class="admonition info">
<p class="admonition-title">source</p>
<p>The trim / gain approach was customized for <a href="https://docs.duckietown.org/daffy/opmanual_duckiebot/out/wheel_calibration.html">Duckiebots</a>. The broader context is
system identification: a good resource for further reading could be <a href="http://underactuated.mit.edu/sysid.html">Russ
Tedrake's underactuated robotics
course</a>.</p>
</div>
<p>After the robot can drive on the straight line without deviating from it too far the final error can be overcome with addtional sensors, such as IMUs, cameras and LiDARs, and then fuse those sensor data to follow a goal location more accurately by constantly adjusting wheel velocities. An even simpler example are IR sensors to follow the line and adjust the wheel velocities according to stay near the line. </p>
<h3 id="pid-tuning">PID Tuning</h3>
<p>To tune the PID controller, the following video provides a helpful overview of
the process. It gives some insights which behavior each PID parameter influences
for a vehicle trying to follow a lane, thereby reducing the cross track error.
However, the same process can be followed to reduce the error <span class="arithmatex">\(e(t)\)</span> being the
difference between the desired (target) angular wheel velocity <span class="arithmatex">\(\dot
\phi_{desired,l/r}\)</span> and the one measured <span class="arithmatex">\(\dot \phi_{measured,l/r}\)</span> by the
encoders:</p>
<div class="arithmatex">\[
e_{l/r} = \dot{\phi}_{desired,l/r} - \dot{\phi}_{measured,l/r}
\]</div>
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/4Y7zG48uHRo" title="YouTube video player" width="560"></iframe>
<p>In case of oscillations (wheel spin direction keeps changing), might happen
because of a too high proportional gain <span class="arithmatex">\(K_P\)</span> or a too low derivative gain
<span class="arithmatex">\(K_D\)</span>. Changing gains should be done one at a time because all are related by
influencing the overall calculated output command <span class="arithmatex">\(u(t)\)</span> via the following equation</p>
<div class="arithmatex">\[
u(t) = K_\text{p} e(t) + K_\text{i} \int_0^t e(\tau) \,\mathrm{d}\tau + K_\text{d} \frac{\mathrm{d}e(t)}{\mathrm{d}t}
\]</div>
<p>One option to start the tuning process is by setting these values:</p>
<p>P = something small until the motors start to spin and no major oscillations are observable
I = 0
D = 0</p>
<p>To overcome oscillations increase the D gain first but usually it will be a value below P (might be one or more magnitudes lower). The derivative term tracks how fast the velocity changes over time. A higher D gain can dampen oscillations and therefore lead to more stable behavior. The D term best estimate of the future trend of the error <span class="arithmatex">\(e(t)\)</span>.
If the derivative gain is too low then the system is called underdamped and will pull too quickly towards the desired velocity, which can easily result in overshooting the target value. On the other hand if the D gain is too high the system is known to be overdamped and it will take a long time to reach the desired velocity.
A properlly chosen D gain will allow to reach the desired velocity quickly with reduced overshoot and therefore a near zero error rate (known as critically damped).</p>
<p>Term I accounts for past values of the error and integrates them over time. This term should be adjust last and increased slightly to tune the behavior further.</p>
<p>In code the values to tune these PID gains are found in the <a href="https://github.com/ros-mobile-robots/diffbot/blob/e7b6c8c5206235a338ef15e20084630793813a4f/diffbot_base/scripts/base_controller/lib/config/diffbot_base_config.h#L18-L20"><code>base_controller_config.h</code></a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#define K_P 0.6 </span><span class="c1">// P constant</span>
<span class="cp">#define K_I 0.3 </span><span class="c1">// I constant</span>
<span class="cp">#define K_D 0.5 </span><span class="c1">// D constant</span>
</code></pre></div></td></tr></table></div>
<h2 id="related-issues-to-pids">Related Issues to PIDs</h2>
<ul>
<li><a href="https://github.com/ros-mobile-robots/diffbot/issues/13">https://github.com/ros-mobile-robots/diffbot/issues/13</a></li>
<li><a href="https://github.com/ros-mobile-robots/diffbot/issues/35">https://github.com/ros-mobile-robots/diffbot/issues/35</a></li>
<li><a href="https://courses.edx.org/courses/course-v1:ETHx+DT-01x+1T2021/discussion/forum/90b2fa2c07d84c70926270dd995f1d57d007f56a/threads/60874666e136290498b20825">Duckietown EDX MOOC Forum question</a></li>
</ul>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Autonomous Differential Drive Mobile Robot - Base Package" class="md-footer__link md-footer__link--prev" href="../" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Autonomous Differential Drive Mobile Robot - Base Package
            </div>
</div>
</a>
<a aria-label="Next: Low-Level PID Approach" class="md-footer__link md-footer__link--next" href="../low-level/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Low-Level PID Approach
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright  2021 - 2021 Franz Pucher | <a href="https://www.ros-mobile-robots.com/privacy-policy/">Privacy Policy</a> | <a href="https://www.ros-mobile-robots.com/legal-notice/">Legal Notice</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
<script src="https://gumroad.com/js/gumroad.js"></script>
<script>
        $(document).ready(function(){
            // Target your .container, .wrapper, .post, etc.
            $(".md-main").fitVids();
        });
    </script>
<!-- cookie consent -->
<script data-cfasync="false" src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
<script>
    window.cookieconsent.initialise({
    "palette": {
        "popup": {
        "background": "#edeff5",
        "text": "#838391"
        },
        "button": {
        "background": "#4b81e8"
        }
    },
    "theme": "classic"
    });
    </script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>