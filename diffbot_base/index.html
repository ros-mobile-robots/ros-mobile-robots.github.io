
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ROS Base Package for ROS Noetic running on a Raspberry Pi 4 for an autonomous 2WD Robot to act in an environment according to sensor information.">
      
      
      
        <link rel="canonical" href="https://ros-mobile-robots.com/diffbot_base/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.7">
    
    
      
        <title>Autonomous Differential Drive Mobile Robot - Base Package - DiffBot Differential Drive Mobile Robot</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
    <script src="../js/jquery-3.5.1.min.js"></script>
    <script src="../js/jquery.fitvids.js"></script>
    <!-- Arithmatex -->
        <!-- MathJax
        <script src="../js/mathjax.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        -->
        <!-- KaTeX -->
        <script src="../js/katex.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"
            integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc=" crossorigin="anonymous">
        </script>
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
    <!-- Pseudocode -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
    <script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
    <script>
        pseudocode.renderElement(document.getElementById("markov-localization"));
    </script>
    <!-- UML diagrams using Mermaid -->
    <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, securityLevel: "loose" });
    </script>
    <!-- Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2214309606626131"
     crossorigin="anonymous"></script>
    <!-- Cookie consent -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />    

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-5Z9V7GPRX3"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-5Z9V7GPRX3",{page_path:e.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5Z9V7GPRX3"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#diffbot-base-package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DiffBot Differential Drive Mobile Robot" class="md-header__button md-logo" aria-label="DiffBot Differential Drive Mobile Robot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DiffBot Differential Drive Mobile Robot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Autonomous Differential Drive Mobile Robot - Base Package
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ros-mobile-robots/diffbot/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../technical-requirements.md" class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../hardware_setup/overview/" class="md-tabs__link">
        Hardware Setup
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../processing_units/" class="md-tabs__link">
        Processing Units
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../packages/" class="md-tabs__link md-tabs__link--active">
        ROS Software Packages
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../theory/" class="md-tabs__link">
        Robotics Theory
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../theory/motion-and-odometry/" class="md-tabs__link">
        Hardware and Theory
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../insiders/" class="md-tabs__link">
      Insiders
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DiffBot Differential Drive Mobile Robot" class="md-nav__button md-logo" aria-label="DiffBot Differential Drive Mobile Robot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DiffBot Differential Drive Mobile Robot
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ros-mobile-robots/diffbot/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technical-requirements.md" class="md-nav__link">
        Technical Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../components/" class="md-nav__link">
        Components
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Hardware Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware Setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Hardware Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_setup/overview/" class="md-nav__link">
        Hardware Setup Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_setup/3D_print/" class="md-nav__link">
        3D Printing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_setup/electronics/" class="md-nav__link">
        Electronics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_setup/assembly/" class="md-nav__link">
        Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_setup/install.md" class="md-nav__link">
        Install
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../processing_units/">Processing Units</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Processing Units" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Processing Units
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/rpi-setup/" class="md-nav__link">
        Raspberry Pi Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/jetson-nano-setup/" class="md-nav__link">
        Jetson Nano Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/git-setup/" class="md-nav__link">
        Git Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/ros-setup/" class="md-nav__link">
        ROS Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/teensy-mcu/" class="md-nav__link">
        Teensy MCU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/hardware-interfaces/" class="md-nav__link">
        Hardware Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_units/ros-network-setup/" class="md-nav__link">
        ROS Network Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../packages/">ROS Software Packages</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="ROS Software Packages" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          ROS Software Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packages/packages-setup/" class="md-nav__link">
        Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_robot/" class="md-nav__link">
        Robot Package
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Robot Description
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Robot Description" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Robot Description
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../robot-description/" class="md-nav__link">
        Robot Description
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packages/remo_description/" class="md-nav__link">
        Remo Description
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_gazebo/" class="md-nav__link">
        Simulation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_control/" class="md-nav__link">
        Control
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Base Hardware Interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Base Hardware Interface
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diffbot-base-package" class="md-nav__link">
    DiffBot Base Package
  </a>
  
    <nav class="md-nav" aria-label="DiffBot Base Package">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffbot_base-package" class="md-nav__link">
    diffbot_base Package
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-interface" class="md-nav__link">
    Hardware Interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pid-controller" class="md-nav__link">
    PID Controller
  </a>
  
    <nav class="md-nav" aria-label="PID Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmakeliststxt" class="md-nav__link">
    CMakeLists.txt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-file" class="md-nav__link">
    Launch File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-requirements" class="md-nav__link">
    Additional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_msgs/" class="md-nav__link">
        Messages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../grove_motor_driver/" class="md-nav__link">
        Motor Driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DG01D-E-motor-with-encoder/" class="md-nav__link">
        Motor and Encoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_navigation/" class="md-nav__link">
        Navigation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_slam/" class="md-nav__link">
        SLAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_mbf/" class="md-nav__link">
        Move Base Flex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diffbot_bringup/" class="md-nav__link">
        Hardware Bringup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packages/raspicam_node/" class="md-nav__link">
        Rasperry Pi Camera
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_16" type="checkbox" id="__nav_5_16" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_16">
          Inertial Measurement Unit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Inertial Measurement Unit" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_16">
          <span class="md-nav__icon md-icon"></span>
          Inertial Measurement Unit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packages/imu/robot_localization/" class="md-nav__link">
        Robot Localization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packages/imu/driver-bno055/" class="md-nav__link">
        BNO055 Driver
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../theory/">Robotics Theory</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Robotics Theory" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Robotics Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Preliminaries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Preliminaries" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Preliminaries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/preliminaries/linear-algebra/" class="md-nav__link">
        Linear Algebra
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/preliminaries/probability/" class="md-nav__link">
        Probability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/preliminaries/programming/" class="md-nav__link">
        Programming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Modeling and Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modeling and Control" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Modeling and Control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/modeling-control/control-systems-introduction/" class="md-nav__link">
        Introduction to Control Systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/modeling-control/robot-representations/" class="md-nav__link">
        Representations and models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/modeling-control/modeling-differential-drive-robot/" class="md-nav__link">
        Modeling a Differential Drive Robot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/modeling-control/odometry/" class="md-nav__link">
        Odometry
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_4">
          Robot Vision
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Robot Vision" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Robot Vision
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/robot-vision/pinhole-camera-model/" class="md-nav__link">
        Pinhole Camera Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/robot-vision/camera-calibration/" class="md-nav__link">
        Camera Calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/robot-vision/image-processing/" class="md-nav__link">
        Image Processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/robot-vision/features-and-segmentation/" class="md-nav__link">
        Features and Segmentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/robot-vision/tracking-image-features/" class="md-nav__link">
        Tracking Image Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/robot-vision/combining-camera-and-lidar/" class="md-nav__link">
        Combining Camera and Lidar
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/object-detection/overview.md" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_6">
          State Estimation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="State Estimation" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          State Estimation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/state-estimation/recursive-state-estimation/" class="md-nav__link">
        Recursive State Estimation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/state-estimation/gaussian-filters.md" class="md-nav__link">
        Gaussian Filters (Kalman Filter)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/state-estimation/nonparametric-filters/" class="md-nav__link">
        Nonparametric Filters (Particle Filter)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" type="checkbox" id="__nav_6_7" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_7">
          Localization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Localization" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_7">
          <span class="md-nav__icon md-icon"></span>
          Localization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/localization/markov-and-gaussian-localization/" class="md-nav__link">
        Markov and Gaussian Localization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/localization/grid-and-monte-carlo-localization.md" class="md-nav__link">
        Grid and Monte Carlo Localization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_8" type="checkbox" id="__nav_6_8" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_8">
          Mapping
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mapping" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_8">
          <span class="md-nav__icon md-icon"></span>
          Mapping
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/mapping/occupancy-grid-mapping.md" class="md-nav__link">
        Occupancy Grid Mapping
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_9" type="checkbox" id="__nav_6_9" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_9">
          Simultaneous Localization and Mapping (SLAM)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Simultaneous Localization and Mapping (SLAM)" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_9">
          <span class="md-nav__icon md-icon"></span>
          Simultaneous Localization and Mapping (SLAM)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/slam-overview/" class="md-nav__link">
        SLAM Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/1.%20Robot%20Moving%20and%20Sensing/" class="md-nav__link">
        Robot Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/2.%20Omega%20and%20Xi%2C%20Constraints/" class="md-nav__link">
        Omega and Xi Constraints Notebook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/3.%20Landmark%20Detection%20and%20Tracking/" class="md-nav__link">
        Project 3:  Implement SLAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/ekf-slam.md" class="md-nav__link">
        EKF SLAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/graphslam.md" class="md-nav__link">
        GraphSLAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/fastslam.md" class="md-nav__link">
        FastSLAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/slam/gmapping.md" class="md-nav__link">
        GMapping
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/planning1/overview.md" class="md-nav__link">
        Planning I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/planning2/overview.md" class="md-nav__link">
        Planning II
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/reinforcement-learning/overview.md" class="md-nav__link">
        Learning by Reinforcement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/imitation-learning/overview.md" class="md-nav__link">
        Learning by Imitation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7">
          Hardware and Theory
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware and Theory" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Hardware and Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/motion-and-odometry/" class="md-nav__link">
        Motion and Odometry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../power-supply/" class="md-nav__link">
        Power Supply
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../laser-range-scanner/" class="md-nav__link">
        Laser Range Scanner
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../insiders/" class="md-nav__link">
        Insiders
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diffbot-base-package" class="md-nav__link">
    DiffBot Base Package
  </a>
  
    <nav class="md-nav" aria-label="DiffBot Base Package">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffbot_base-package" class="md-nav__link">
    diffbot_base Package
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-interface" class="md-nav__link">
    Hardware Interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pid-controller" class="md-nav__link">
    PID Controller
  </a>
  
    <nav class="md-nav" aria-label="PID Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmakeliststxt" class="md-nav__link">
    CMakeLists.txt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-file" class="md-nav__link">
    Launch File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-requirements" class="md-nav__link">
    Additional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              



                
<a href="https://github.com/ros-mobile-robots/ros-mobile-robots.github.io/tree/main/docs/diffbot_base.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>Base Hardware Interface</h1>

<h2 id="diffbot-base-package">DiffBot Base Package</h2>
<p>This package contains the so called hardware interface of DiffBot which represents the real hardware in software to work with 
<a href="http://wiki.ros.org/ros_control">ROS Control</a>. </p>
<figure>
    <a href="/resources/ros_control_overview.png"><img src="/resources/ros_control_overview.png"></a>
    <figcaption><a href="http://wiki.ros.org/ros_control#Overview" title="ROS Control">ROS Control</a> Overview.</figcaption>
</figure>

<p>In the simpleste case all that is needed in this package is to write a class that inherits from <code>hardware_interface::RobotHW</code> and provide a launch
file. The launch file will </p>
<ul>
<li>Load the robot description from <code>diffbot_description</code> to the paramter server</li>
<li>Run the hardware interface of this package <code>diffbot_base</code></li>
<li>Load the controller configuration yaml from the <code>diffbot_control</code> package to the <a href="http://wiki.ros.org/Parameter%20Server">parameter server</a></li>
<li>Load the controllers with the <a href="http://wiki.ros.org/controller_manager?distro=noetic">controller manager</a></li>
<li>Load the value of the encoder resolution to the parameter server</li>
</ul>
<h3 id="diffbot_base-package">diffbot_base Package</h3>
<p>The <code>diffbot_base</code> package is created with <code>catkin-tools</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="gp">fjp@diffbot:/home/fjp/catkin_ws/src$ </span>catkin create pkg diffbot_base --catkin-deps diff_drive_controller hardware_interface roscpp sensor_msgs rosparam_shortcuts                 
<span class="go">Creating package &quot;diffbot_base&quot; in &quot;/home/fjp/catkin_ws/src&quot;...</span>
<span class="go">Created file diffbot_base/package.xml</span>
<span class="go">Created file diffbot_base/CMakeLists.txt</span>
<span class="go">Created folder diffbot_base/include/diffbot_base</span>
<span class="go">Created folder diffbot_base/src</span>
<span class="go">Successfully created package files in /home/fjp/catkin_ws/src/diffbot_base.</span>
</code></pre></div>
</td></tr></table>
<p>To work with this package the specified dependencies must be installed either using the available Ubuntu/Debian packages for ROS Noetic or they have to be built from source first. The following table lists the dependencies that we have to install because they are not already part of the ROS Noetic desktop full installation. Refer to the section <a href="https://fjp.at/projects/diffbot/ros-noetic/">ROS Noetic Setup</a> for how this was done. </p>
<table>
<thead>
<tr>
<th align="center">Dependency</th>
<th align="center">Source</th>
<th align="center">Ubuntu/Debian Package</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>rosparam_shortcuts</code></td>
<td align="center"><a href="https://github.com/PickNikRobotics/rosparam_shortcuts">https://github.com/PickNikRobotics/rosparam_shortcuts</a></td>
<td align="center"><code>ros-noetic-rosparam-shortcuts</code></td>
</tr>
<tr>
<td align="center"><code>hardware_interface</code></td>
<td align="center"><a href="https://github.com/ros-controls/ros_control">https://github.com/ros-controls/ros_control</a></td>
<td align="center"><code>ros-noetic-ros-control</code></td>
</tr>
<tr>
<td align="center"><code>diff_drive_controller</code></td>
<td align="center"><a href="https://github.com/ros-controls/ros_controllers">https://github.com/ros-controls/ros_controllers</a></td>
<td align="center"><code>ros-noetic-ros-controllers</code></td>
</tr>
</tbody>
</table>
<p>To install a package from source clone (using git) or download the source files from where they are located (commonly hosted on GitHub) into the <code>src</code> folder of a ros catkin workspace and execute the <a href="https://catkin-tools.readthedocs.io/en/latest/verbs/catkin_build.html"><code>catkin build</code></a> command. Also make sure to source the workspace after building new packages with <code>source devel/setup.bash</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="go">cd /homw/fjp/git/diffbot/ros/  # Navigate to the workspace</span>
<span class="go">catkin build              # Build all the packages in the workspace</span>
<span class="go">ls build                  # Show the resulting build space</span>
<span class="go">ls devel                  # Show the resulting devel space</span>
</code></pre></div>
</td></tr></table>
<p class="notice">Make sure to clone/download the source files suitable for the ROS distribtion you are using. If the sources are not available for the distribution you are working with, it is worth to try building anyway. Chances are that the package you want to use is suitable for multiple ROS distros. For example if a package states in its docs, that it is only available for <a href="http://wiki.ros.org/kinetic">kinetic</a> it is possible that it will work with a ROS <a href="http://wiki.ros.org/noetic">noetic</a> install.</p>
<h3 id="hardware-interface">Hardware Interface</h3>
<p>See the <a href="../diffbot_base/include"><code>include</code></a> and <a href="../diffbot_base/src"><code>src</code></a> folders of this package and the details on the hardware interface implementation.
For more details on the hardware interface also refer to the section <a href="https://fjp.at/projects/diffbot/ros-integration/#ros-control">ROS Integration: Control</a>, it gives more details and also this <a href="https://fjp.at/posts/ros/ros-control/">overview article about ROS Control</a>.</p>
<p>The hardware interface provides an interface between the real robot hardware and the controllers provided by ROS Control (or even custom controllers).
DiffBot works with the <code>diff_drive_controller</code> that is configured in the <code>diffbot_control</code> package, which is also relevant for the simulation in Gazebo.
Remember that the simulation uses the <code>gazebo_ros_control</code> package to communicate with the <code>diff_drive_controller</code>. For the real robot hardware,
ROS Control uses an instance of type <a href="http://docs.ros.org/en/noetic/api/hardware_interface/html/c++/"><code>hardware_interface::RobotHW</code></a> that is passed to the <code>controller_manager</code> to handle the resources, meaning that the actuated robot joints are not in use by multiple controllers that might be loaded.</p>
<p>The skeleton of DiffBot's hardware interface looks like following, where the constructor is used to read loaded configuration values from 
the robot's description from the ROS parameter server:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">diffbot_base</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">DiffBotHWInterface</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nh</span><span class="p">,</span><span class="w"> </span><span class="n">urdf</span><span class="o">::</span><span class="n">Model</span><span class="w"> </span><span class="o">*</span><span class="n">urdf_model</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name_</span><span class="p">(</span><span class="s">&quot;hardware_interface&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">nh_</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span><span class="c1">// Initialization of the robot&#39;s resources (joints, sensors, actuators) and</span>
<span class="w">        </span><span class="c1">// interfaces can be done here or inside init().</span>
<span class="w">        </span><span class="c1">// E.g. parse the URDF for joint names &amp; interfaces, then initialize them</span>
<span class="w">        </span><span class="c1">// Check if the URDF model needs to be loaded</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">urdf_model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">loadURDF</span><span class="p">(</span><span class="n">nh</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;robot_description&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">            </span><span class="n">urdf_model_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urdf_model</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Load rosparams</span>
<span class="w">        </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="nf">rpnh</span><span class="p">(</span><span class="n">nh_</span><span class="p">,</span><span class="w"> </span><span class="n">name_</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Code API of rosparam_shortcuts:</span>
<span class="w">        </span><span class="c1">// http://docs.ros.org/en/noetic/api/rosparam_shortcuts/html/namespacerosparam__shortcuts.html#aa6536fe0130903960b1de4872df68d5d</span>
<span class="w">        </span><span class="n">error</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">!</span><span class="n">rosparam_shortcuts</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">name_</span><span class="p">,</span><span class="w"> </span><span class="n">rpnh</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;joints&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joint_names_</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">error</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">!</span><span class="n">rosparam_shortcuts</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">name_</span><span class="p">,</span><span class="w"> </span><span class="n">nh_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mobile_base_controller/wheel_radius&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wheel_radius_</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">error</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">!</span><span class="n">rosparam_shortcuts</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">name_</span><span class="p">,</span><span class="w"> </span><span class="n">nh_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mobile_base_controller/linear/x/max_velocity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_velocity_</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">rosparam_shortcuts</span><span class="o">::</span><span class="n">shutdownIfError</span><span class="p">(</span><span class="n">name_</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">wheel_diameter_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wheel_radius_</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">//max_velocity_ = 0.2; // m/s</span>
<span class="w">        </span><span class="c1">// ros_control RobotHW needs velocity in rad/s but in the config its given in m/s</span>
<span class="w">        </span><span class="n">max_velocity_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linearToAngular</span><span class="p">(</span><span class="n">max_velocity_</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Setup publisher for the motor driver </span>
<span class="w">        </span><span class="n">pub_left_motor_value_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh_</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Int32</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;motor_left&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pub_right_motor_value_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh_</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Int32</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;motor_right&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Setup subscriber for the wheel encoders</span>
<span class="w">        </span><span class="n">sub_left_encoder_ticks_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh_</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;ticks_left&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">leftEncoderTicksCallback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">sub_right_encoder_ticks_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh_</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;ticks_right&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">rightEncoderTicksCallback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Initialize the hardware interface</span>
<span class="w">        </span><span class="n">init</span><span class="p">(</span><span class="n">nh_</span><span class="p">,</span><span class="w"> </span><span class="n">nh_</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="o">&amp;</span><span class="n">root_nh</span><span class="p">,</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="o">&amp;</span><span class="n">robot_hw_nh</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Initializing DiffBot Hardware Interface ...&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">num_joints_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">joint_names_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Number of joints: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">num_joints_</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_JOINTS</span><span class="o">&gt;</span><span class="w"> </span><span class="n">motor_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;left_motor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;right_motor&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_joints_</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Create a JointStateHandle for each joint and register them with the </span>
<span class="w">            </span><span class="c1">// JointStateInterface.</span>
<span class="w">            </span><span class="n">hardware_interface</span><span class="o">::</span><span class="n">JointStateHandle</span><span class="w"> </span><span class="nf">joint_state_handle</span><span class="p">(</span><span class="n">joint_names_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"></span>
<span class="w">                                                                    </span><span class="o">&amp;</span><span class="n">joint_positions_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">                                                                    </span><span class="o">&amp;</span><span class="n">joint_velocities_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"></span>
<span class="w">                                                                    </span><span class="o">&amp;</span><span class="n">joint_efforts_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">joint_state_interface_</span><span class="p">.</span><span class="n">registerHandle</span><span class="p">(</span><span class="n">joint_state_handle</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Create a JointHandle (read and write) for each controllable joint</span>
<span class="w">            </span><span class="c1">// using the read-only joint handles within the JointStateInterface and </span>
<span class="w">            </span><span class="c1">// register them with the JointVelocityInterface.</span>
<span class="w">            </span><span class="n">hardware_interface</span><span class="o">::</span><span class="n">JointHandle</span><span class="w"> </span><span class="nf">joint_handle</span><span class="p">(</span><span class="n">joint_state_handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">velocity_joint_interface_</span><span class="p">.</span><span class="n">registerHandle</span><span class="p">(</span><span class="n">joint_handle</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Initialize joint states with zero values</span>
<span class="w">            </span><span class="n">joint_positions_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">joint_velocities_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">joint_efforts_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// unused with diff_drive_controller</span>

<span class="w">            </span><span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Initialize the pid controllers for the motors using the robot namespace</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pid_namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pid/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">motor_names</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">&quot;pid namespace: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid_namespace</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="nf">nh</span><span class="p">(</span><span class="n">root_nh</span><span class="p">,</span><span class="w"> </span><span class="n">pid_namespace</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="c1">// TODO implement builder pattern to initialize values otherwise it is hard to see which parameter is what.</span>
<span class="w">            </span><span class="n">pids_</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">init</span><span class="p">(</span><span class="n">nh</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">10.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">max_velocity_</span><span class="p">,</span><span class="w"> </span><span class="n">max_velocity_</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">pids_</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">setOutputLimits</span><span class="p">(</span><span class="o">-</span><span class="n">max_velocity_</span><span class="p">,</span><span class="w"> </span><span class="n">max_velocity_</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Register the JointStateInterface containing the read only joints</span>
<span class="w">        </span><span class="c1">// with this robot&#39;s hardware_interface::RobotHW.</span>
<span class="w">        </span><span class="n">registerInterface</span><span class="p">(</span><span class="o">&amp;</span><span class="n">joint_state_interface_</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Register the JointVelocityInterface containing the read/write joints</span>
<span class="w">        </span><span class="c1">// with this robot&#39;s hardware_interface::RobotHW.</span>
<span class="w">        </span><span class="n">registerInterface</span><span class="p">(</span><span class="o">&amp;</span><span class="n">velocity_joint_interface_</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;... Done Initializing DiffBot Hardware Interface&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// The read method is part of the control loop cycle (read, update, write) and is used to </span>
<span class="w">    </span><span class="c1">// populate the robot state from the robot&#39;s hardware resources (joints, sensors, actuators). </span>
<span class="w">    </span><span class="c1">// This method should be called before controller_manager::ControllerManager::update() and write.</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">read</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="o">&amp;</span><span class="w"> </span><span class="n">period</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">elapsed_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">period</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Read from robot hw (motor encoders)</span>
<span class="w">        </span><span class="c1">// Fill joint_state_* members with read values</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">wheel_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">wheel_angle_deltas</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_joints_</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">wheel_angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ticksToAngle</span><span class="p">(</span><span class="n">encoder_ticks_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="c1">//double wheel_angle_normalized = normalizeAngle(wheel_angle);</span>
<span class="w">            </span><span class="n">wheel_angle_deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wheel_angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">joint_positions_</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>

<span class="w">            </span><span class="n">joint_positions_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">wheel_angle_deltas</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="n">joint_velocities_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wheel_angle_deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">period</span><span class="p">.</span><span class="n">toSec</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">joint_efforts_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// unused with diff_drive_controller</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// The write method is part of the control loop cycle (read, update, write) and is used to </span>
<span class="w">    </span><span class="c1">// send out commands to the robot&#39;s hardware resources (joints, actuators). </span>
<span class="w">    </span><span class="c1">// This method should be called after read and controller_manager::ControllerManager::update.</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">write</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="o">&amp;</span><span class="w"> </span><span class="n">period</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">elapsed_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">period</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Write to robot hw</span>
<span class="w">        </span><span class="c1">// joint velocity commands from ros_control&#39;s RobotHW are in rad/s</span>
<span class="w">        </span><span class="c1">// Convert the velocity command to a percentage value for the motor</span>
<span class="w">        </span><span class="c1">// This maps the velocity to a percentage value which is used to apply</span>
<span class="w">        </span><span class="c1">// a percentage of the highest possible battery voltage to each motor.</span>
<span class="w">        </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Int32</span><span class="w"> </span><span class="n">left_motor</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Int32</span><span class="w"> </span><span class="n">right_motor</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">output_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pids_</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">joint_velocities_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">period</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">output_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pids_</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">joint_velocities_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">joint_velocity_commands_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">period</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">left_motor</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output_left</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max_velocity_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">right_motor</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output_right</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max_velocity_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100.0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Publish the PID computed motor commands to the left and right motors</span>
<span class="w">    </span><span class="n">pub_left_motor_value_</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">left_motor</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pub_right_motor_value_</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">right_motor</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Process updates from encoders using a subscriber</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">leftEncoderTicksCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Int32</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">encoder_ticks_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ROS_DEBUG_STREAM_THROTTLE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Left encoder ticks: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">rightEncoderTicksCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Int32</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">encoder_ticks_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ROS_DEBUG_STREAM_THROTTLE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Right encoder ticks: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">DiffBotHWInterface</span><span class="o">::</span><span class="n">ticksToAngle</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ticks</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Convert number of encoder ticks to angle in radians</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ticks</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">M_PI</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">542.0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">ROS_DEBUG_STREAM_THROTTLE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ticks</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ticks correspond to an angle of &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">angle</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">angle</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="p">};</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>The functions above are designed to give the controller manager (and the controllers inside the controller manager) access to the joint state of custom robot, 
and to command it. When the controller manager runs, the controllers will read from the pos, vel and eff variables of the custom robot hardware interface, and the controller will write the desired command into the cmd variable. It's mandatory to make sure the pos, vel and eff variables always have the latest joint state available, and to make sure that whatever is written into the cmd variable gets executed by the robot. This can be done by implementing hardware_interface::RobotHW::read() and a hardware_interface::RobotHW::write() methods.</p>
<p>The main node that will be executed uses the <code>controller_manager</code> to operate the so called control loop. 
In the case of  DiffBot a simple example looks like the following, 
refer to the <a href="https://github.com/ros-mobile-robots/diffbot/blob/noetic-devel/diffbot_base/src/diffbot_base.cpp"><code>diffbot_base.cpp</code></a> for the complete implementation:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;diffbot_base/diffbot_hw_interface.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;controller_manager/controller_manager.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Initialize the ROS node</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;diffbot_hw_interface&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">nh</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Create an instance of your robot so that this instance knows about all </span>
<span class="w">    </span><span class="c1">// the resources that are available.</span>
<span class="w">    </span><span class="n">diffbot_base</span><span class="o">::</span><span class="n">DiffBotHWInterface</span><span class="w"> </span><span class="n">diffBot</span><span class="p">(</span><span class="n">nh</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Create an instance of the controller manager and pass it the robot, </span>
<span class="w">    </span><span class="c1">// so that it can handle its resources.</span>
<span class="w">    </span><span class="n">controller_manager</span><span class="o">::</span><span class="n">ControllerManager</span><span class="w"> </span><span class="n">cm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">diffBot</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Setup a separate thread that will be used to service ROS callbacks.</span>
<span class="w">    </span><span class="c1">// NOTE: We run the ROS loop in a separate thread as external calls such</span>
<span class="w">    </span><span class="c1">// as service callbacks to load controllers can block the (main) control loop</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">AsyncSpinner</span><span class="w"> </span><span class="n">spinner</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">spinner</span><span class="p">.</span><span class="n">start</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Setup for the control loop.</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">prev_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Rate</span><span class="w"> </span><span class="n">rate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10 Hz rate</span>

<span class="w">    </span><span class="c1">// Blocks until shutdown signal recieved</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Basic bookkeeping to get the system time in order to compute the control period.</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="w">     </span><span class="n">time</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prev_time</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Execution of the actual control loop.</span>
<span class="w">        </span><span class="n">diffBot</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">period</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// If needed, its possible to define transmissions in software by calling the </span>
<span class="w">        </span><span class="c1">// transmission_interface::ActuatorToJointPositionInterface::propagate()</span>
<span class="w">        </span><span class="c1">// after reading the joint states.</span>
<span class="w">        </span><span class="n">cm</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">period</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// In case of software transmissions, use </span>
<span class="w">        </span><span class="c1">// transmission_interface::JointToActuatorEffortHandle::propagate()</span>
<span class="w">        </span><span class="c1">// to convert from the joint space to the actuator space.</span>
<span class="w">        </span><span class="n">diffBot</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">period</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// All these steps keep getting repeated with the specified rate.</span>
<span class="w">        </span><span class="n">rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>As we can see, the basic steps are to initialize the node, instantiate the hardware interface, pass it to a new controller manager and run the
control loop that does the following:</p>
<ul>
<li>Read joint states from the real robot hardware</li>
<li>Update the <code>diff_drive_controller</code> with read values and compute the joint velocities using the target <code>cmd_vel</code></li>
<li>Write the computed values </li>
</ul>
<p>You may be wondering why the read values aren't returned from the <code>diffbot.read()</code> method and nothing is passed to the <code>diffbot.write()</code>.
This is because the <code>RobotHW::init()</code> method, shown in the first code snippet, is used to register the actuated joint names (described in the <code>diffbot_description</code>) to the <code>joint_position</code>, <code>joint_velocity</code> and <code>joint_effort</code> member variables of the custom robot hardware interface.
The class that registers the variables of the controller with the hardware interface member variables and thereby gives read access to all joint values 
without conflicting with other controllers, is the <a href="http://docs.ros.org/en/noetic/api/hardware_interface/html/c++/classhardware__interface_1_1JointStateInterface.html"><code>hardware_interface::JointStateInterface</code></a>. 
ROS Control uses the <code>hardware_interface::VelocityJointInterface</code> (part of the <a href="http://docs.ros.org/en/noetic/api/hardware_interface/html/c++/joint__command__interface_8h_source.html"><code>joint_command_interface.h</code></a>) 
that registers the command member variable of the controller with the hardware interface to provide it the command that should be written to the actuators.</p>
<p>When the controller manager runs, the controllers will read from the <code>joint_position</code>, <code>joint_velocity</code> and <code>joint_effort</code> variables of the custom robot hardware interface, and the controller will write the desired command into the <code>joint_velocity_command</code> variable. It's mandatory to make sure the position, velocity and effort (effort is not needed in the case of the <code>diff_drive_controller</code>) variables always have the latest joint state available, and to make sure that whatever is written into the <code>joint_velocity_command</code> variable gets executed by the robot. As mentioned this can be done by implementing <code>hardware_interface::RobotHW::read()</code> and a <code>hardware_interface::RobotHW::write()</code> methods.</p>
<p>In the control loop the <a href="https://github.com/fjp/diffbot/blob/522cba34117ea4cf90e3e0b5b9b70f0824e226fc/diffbot_base/src/diffbot_hw_interface.cpp#L106">overriden <code>hardware_interface::RobotHW::read()</code> method of DiffBot</a> is used to read the joint states. The <code>diff_drive_controller</code> works with a VelocityInterface which is why the <code>joint_position</code>, defined in rad, and <code>joint_velocity</code>, defined in rad/s, are calculated from the encoder ticks.</p>
<h2 id="pid-controller">PID Controller</h2>
<p :=":" class="notice">Note the two PID controllers inside the hardware interface, where each PID is passed the error between velocity measured by the encoders 
and the target velocity computed by the <code>diff_drive_controller</code> for a specific wheel joint. 
The <code>diff_drive_controller</code> doesn't have a PID controller integrated, and doesn't take care if the wheels of the robot are actually turning.
As mentioned above, ROS Control expects that the commands sent by the controller are actually implemented on the real robot hardware and that the
joint states are always up to date. This means that the <code>diff_drive_controller</code> just uses the <code>twist_msg</code> on the <code>cmd_vel</code> topic for example from the <code>rqt_robot_steering</code> and converts it to a velocity command for the motors. It doesn't take the actual velocity of the motors into account. 
See <a href="https://github.com/ros-controls/ros_controllers/blob/698f85b2c3467dfcc3ca5743d68deba03f3fcff2/diff_drive_controller/src/diff_drive_controller.cpp#L460">the code of <code>diff_drive_controller</code></a> where the <code>joint_command_velocity</code> is calculated. </p>
<p>This is why a PID controller is needed to avoid situations like the following where the robot moves not straigth although it is commanded to do so:</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/chUPeWXtim4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>The PID used here inherits from the ROS Control <a href="http://wiki.ros.org/control_toolbox"><code>control_toolbox::Pid</code></a> that provides Dynamic Reconfigure out of the box to tune the proportional, integral and derivative gains. The behaviour when using only the P, I and D gains is that the output can overshoot and even change between positive and negative motor percent values because of a P gain that is too high. To avoid this, a feed forward gain can help to reach the setpoint faster.
To add this feed forward gain to the dynamic reconfigure parameters it is necessary to add a new parameter configuration file in this package inside a <code>cfg</code> folder. </p>
<p>For more details on ROS dynamic reconfigure see <a href="http://wiki.ros.org/dynamic_reconfigure/Tutorials">the official tutorials</a>.</p>
<p>With the use of the PID controller the robot is able to drive straight:</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/fdn5Mu0Qhl8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>In case of using inexpensive motors like the <a href="https://www.sparkfun.com/products/16413">DG01D-E</a> of DiffBot,
you have to take inaccurate driving behaviour into account. The straight driving behaviour can be improved
with motors that start spinning at the same voltage levels. To find suitable motors do a voltage sweep test by slightly increasing the voltage and
note the voltage level where each motor starts to rotate. Such a test was done on DiffBot's motors. </p>
<p>Using six <a href="https://www.sparkfun.com/products/16413">DG01D-E</a> motors the following values were recorded (sorted by increasing voltage):</p>
<table>
<thead>
<tr>
<th align="center">Motor</th>
<th align="center">Voltage (V)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">01</td>
<td align="center">2.5</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">2.8 - 3.0</td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">3.1</td>
</tr>
<tr>
<td align="center">04</td>
<td align="center">3.2</td>
</tr>
<tr>
<td align="center">05</td>
<td align="center">3.2</td>
</tr>
<tr>
<td align="center">06</td>
<td align="center">3.3</td>
</tr>
</tbody>
</table>
<p class="notice">In the videos above, motors numbered 01 and 03 were used coincidencely and I wasn't aware of the remarkable differences in voltage levels.
Using the motors 04 and 05 improved the driving behaviour significantly. </p>
<p>To deal with significant differences in the motors it would also help to tune the two PIDs individually,
which is not shown in the <a href="https://youtu.be/fdn5Mu0Qhl8">video above</a>.</p>
<p class="notice">Make also sure that the motor driver outputs the same voltage level on both channels when the robot is commanded to move straight.
The used Grove i2c motor driver was tested to do this.
Another problem of not driving straight can be weight distribution or the orientation of the caster wheel.</p>
<p>A good test to check the accuracy is to fix two meters of adhesive tape on the floor in a straight line. 
Then, place the robot on one end oriented in the direction to the other end. Now command it to move straight along the line
and stop it when it reaches the end of the tape. Record the lateral displacement from the tape. 
Measuring a value below 10 cm is considered precise for these motors.</p>
<h3 id="cmakeliststxt">CMakeLists.txt</h3>
<p>The <code>diffbot_hw_interface</code> target library of the <code>diffbot_base</code> package depends on the custom <code>diffbot_msgs</code>.
To have them built first, add the following to the <code>CMakeLists.txt</code> of the <code>diffbot_base</code> package:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>add_dependencies(diffbot_hw_interface diffbot_msgs_generate_messages_cpp)
</code></pre></div>
</td></tr></table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This makes sure message headers of this package are generated before being used. 
If you use messages from other packages inside your catkin workspace, 
you need to add dependencies to their respective generation targets as well, because catkin builds all projects in parallel.<sup id="fnref:pubsubtut"><a class="footnote-ref" href="#fn:pubsubtut">1</a></sup></p>
</div>
<h3 id="launch-file">Launch File</h3>
<p>To run a single controller_manager, the one from the <code>diffbot_base</code> package defined inside <code>difbot_base.cpp</code> use the 
launch file from <a href="https://github.com/fjp/diffbot/blob/master/ros/src/diffbot_base/launch/diffbot.launch"><code>diffbot_base/launch/diffbot.launch</code></a>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- https://github.com/ros-controls/ros_controllers/tree/kinetic-devel/diff_drive_controller/test --&gt;</span>
<span class="nt">&lt;launch&gt;</span>
    <span class="cm">&lt;!-- Load DiffBot model --&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;robot_description&quot;</span>
       <span class="na">command=</span><span class="s">&quot;$(find xacro)/xacro &#39;$(find diffbot_description)/urdf/diffbot.xacro&#39;&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;diffbot_base&quot;</span> <span class="na">pkg=</span><span class="s">&quot;diffbot_base&quot;</span> <span class="na">type=</span><span class="s">&quot;diffbot_base&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- Load controller config to the parameter server --&gt;</span>
    <span class="nt">&lt;rosparam</span> <span class="na">command=</span><span class="s">&quot;load&quot;</span> 
              <span class="na">file=</span><span class="s">&quot;$(find diffbot_control)/config/diffbot_control.yaml&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- Load base config to the parameter server --&gt;</span>
    <span class="nt">&lt;rosparam</span> <span class="na">command=</span><span class="s">&quot;load&quot;</span> 
              <span class="na">file=</span><span class="s">&quot;$(find diffbot_base)/config/base.yaml&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- Load the controllers --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;controller_spawner&quot;</span> <span class="na">pkg=</span><span class="s">&quot;controller_manager&quot;</span> <span class="na">type=</span><span class="s">&quot;spawner&quot;</span> <span class="na">respawn=</span><span class="s">&quot;false&quot;</span>
        <span class="na">output=</span><span class="s">&quot;screen&quot;</span> <span class="na">ns=</span><span class="s">&quot;diffbot&quot;</span> <span class="na">args=</span><span class="s">&quot;joint_state_controller</span>
<span class="s">                                            mobile_base_controller&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</code></pre></div>
</td></tr></table>
<p>This will load the DiffBot robot description onto the parameter server which is required for the hardware interface that gets created inside the next
node <code>diffbot_base</code>. It creates the hardware interface and instantiates a new controller manager in the <code>diffbot_base.cpp</code>.
Finally the <code>spawner</code> from the <code>controller_manager</code> package is used to initialize and start the controllers defined in the <code>diffbot_control/config/diffbot_control.yaml</code>. This step of the launch file is required to get the controllers initialized and started.
Another way would be to use <code>controller_manager::ControllerManager::loadControllers()</code> inside the <code>diffbot_base.cpp</code>.</p>
<p>Additionally the launch file loads additional parameters, stored in the <code>diffbot_base/config/base.yaml</code> on the parameter server.
These parameters are hardware related and used to tune the driving behaviour:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># Hardware related parameters
# will be loaded onto the parameter server
# See the diffbot.launch
diffbot:
  encoder_resolution: 542
  gain: 1.0
  trim: 0.0
  motor_constant: 27.0
  pwm_limit: 1.0
  debug:
    hardware_interface: false
    base_controller: true
</code></pre></div>
</td></tr></table>
<p>After launching this launch file on DiffBot's single board computer (e.g. Raspberry Pi or Jetson Nano) with </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="go">roslaunch diffbot_base diffbot.launch</span>
</code></pre></div>
</td></tr></table>
<p>the following parameters are stored on the parameter server:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>rosparam list
<span class="go">/diffbot/hardware_interface/joints</span>
<span class="go">/diffbot/joint_state_controller/extra_joints</span>
<span class="go">/diffbot/joint_state_controller/publish_rate</span>
<span class="go">/diffbot/joint_state_controller/type</span>
<span class="go">/diffbot/mobile_base_controller/base_frame_id</span>
<span class="go">/diffbot/mobile_base_controller/left_wheel</span>
<span class="go">/diffbot/mobile_base_controller/pose_covariance_diagonal</span>
<span class="go">/diffbot/mobile_base_controller/publish_rate</span>
<span class="go">/diffbot/mobile_base_controller/right_wheel</span>
<span class="go">/diffbot/mobile_base_controller/twist_covariance_diagonal</span>
<span class="go">/diffbot/mobile_base_controller/type</span>
<span class="go">/diffbot/mobile_base_controller/wheel_radius</span>
<span class="go">/diffbot/mobile_base_controller/wheel_separation</span>
<span class="go">/robot_description</span>
<span class="go">/rosdistro</span>
<span class="go">/roslaunch/uris/host_tensorbook__46157</span>
<span class="go">/roslaunch/uris/host_ubuntu__33729</span>
<span class="go">/rosversion</span>
<span class="go">/run_id</span>
</code></pre></div>
</td></tr></table>
<h2 id="additional-requirements">Additional Requirements</h2>
<p>Because the hardware interface subscribes to the encoders, that are connected to the Teensy MCU, and publishes to the motors via the motr driver node,
another launch will be required to run these additional nodes. See the <code>diffbot_bringup</code> package for this setup.</p>
<h2 id="simulation">Simulation</h2>
<p>To have a simulation showing DiffBot, the second step is to use the <a href="https://github.com/fjp/diffbot/blob/master/ros/src/diffbot_gazebo/launch/diffbot_base.launch"><code>diffbot_gazebo/launch/diffbot_base.launch</code></a> on the work pc:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>roslaunch diffbot_gazebo diffbot_base.launch
</code></pre></div>
</td></tr></table>
<p>This will launch the gazebo simulation, which can make use of the running controllers inside the controller manager too:</p>
<figure>
    <a href="/resources/ros_control_gazebo.png"><img src="/resources/ros_control_gazebo.png"></a>
    <figcaption><a href="http://gazebosim.org/tutorials/?tut=ros_control" title="ROS Control with Gazebo">ROS Control with Gazebo</a> Overview.</figcaption>
</figure>

<p>After launching the Gazebo simulation the controllers got uninitialized.
(It is assumed that the <a href="https://github.com/ros-simulation/gazebo_ros_pkgs/tree/kinetic-devel/gazebo_ros_control"><code>gazebo_ros_control</code></a> plugin that gets launched). Because of this the controllers have to be initialized and started again. For this the <a href="https://github.com/fjp/diffbot/blob/master/ros/src/diffbot_base/launch/controllers.launch"><code>diffbot_base/launch/controllers.launch</code></a> should be used.
This launch file is just loading and starting all controllers again. Note that using the <code>spawner</code> from the <code>controller_manager</code> package, like in the <code>diffbot_base/launch/diffbot.launch</code> results in an error. (TODO this needs some more testing).</p>
<h2 id="references">References</h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:pubsubtut">
<p><a href="http://wiki.ros.org/ROS/Tutorials/WritingPublisherSubscriber%28c%2B%2B%29#roscpp_tutorials.2FTutorials.2FWritingPublisherSubscriber.Building_your_nodes">ROS Tutorials: Writing Publisher Subscriber, Building your nodes</a>&#160;<a class="footnote-backref" href="#fnref:pubsubtut" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>

              

            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../diffbot_control/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Control" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Control
            </div>
          </div>
        </a>
      
      
        
        <a href="../diffbot_msgs/" class="md-footer__link md-footer__link--next" aria-label="Next: Messages" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Messages
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2021 Franz Pucher | <a href="https://www.ros-mobile-robots.com/privacy-policy/">Privacy Policy</a> | <a href="https://www.ros-mobile-robots.com/legal-notice/">Legal Notice</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
    
      <script src="../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
    
    <script src="https://gumroad.com/js/gumroad.js"></script>
    <script>
        $(document).ready(function(){
            // Target your .container, .wrapper, .post, etc.
            $(".md-main").fitVids();
        });
    </script>
    <!-- cookie consent -->
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <script>
    window.cookieconsent.initialise({
    "palette": {
        "popup": {
        "background": "#edeff5",
        "text": "#838391"
        },
        "button": {
        "background": "#4b81e8"
        }
    },
    "theme": "classic"
    });
    </script>

  </body>
</html>